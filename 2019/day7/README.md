# Day 7: 증폭 회로 (Amplification Circuit)
<https://adventofcode.com/2019/day/7>

## Part 1
항로 지도를 따라서 산타에게 제시간에 도착하려면, 우주선의 추진 엔진에 더 많은 동력을 제공해야 합니다. 이를 위해, 우주선에 설치되어 있는 일련의 증폭기들을 조정해주어야 합니다.  

우주선에는 다섯 대의 증폭기가 한줄로 설치되어 있습니다. 각 증폭기는 입력 신호를 받고, 출력 신호를 만들어냅니다. 증폭기들은 연결되어 있는데, 첫 번째 증폭기의 출력이 두 번째 증폭기의 입력으로, 두 번째 증폭기의 출력이 세 번째 증폭기의 입력이 되는 식으로 이어져있습니다. 첫 번째 증폭기의 입력 신호는 `0`이고, 마지막 증폭기의 출력이 추진 엔진으로 전달됩니다.  

``` text
    O-------O  O-------O  O-------O  O-------O  O-------O
0 ->| Amp A |->| Amp B |->| Amp C |->| Amp D |->| Amp E |-> (to thrusters)
    O-------O  O-------O  O-------O  O-------O  O-------O
```

요정들은 당신에게 증폭기 제어 프로그램(퍼즐 입력)을 보냈습니다. 이 프로그램은 당신이 만든 **정수 컴퓨터**에서 실행하면 됩니다. 증폭기는 이 프로그램의 복사본을 각각 가지게 될 것입니다.  

증폭기에서 프로그램이 실행되면, 프로그램은 우선 페이즈 설정을 요청하는 입력 명령어를 실행할 것입니다. 페이즈는 `0`부터 `4`까지 있으며, 각 숫자는 정확히 한 번씩만 쓰입니다. 하지만 요정들은 어떤 증폭기에 어떤 페이즈 설정을 사용해야 하는지는 기억하지 못했습니다.  

페이즈 설정을 입력하고 나면, 프로그램은 증폭기의 입력 신호를 요청하는 또 다른 입력 명령어를 실행할 것입니다. 입력 신호가 도착하지 않으면 도착할 때까지 기다리며, 도착하고 나면 프로그램은 이들을 바탕으로 출력신호를 계산하여 출력 명령어를 사용해 내보낼 것입니다.  

당신은 페이즈 설정의 가능한 모든 조합을 테스트하여, 이 증폭기들을 이용해 만들어낼 수 있는 최대한의 출력을 찾아내야 합니다. 각 증폭기(복사된 프로그램) 사이에서는 메모리가 공유되지 않는다는 점에 주의하세요.  

예를 들어, 페이즈 설정 `3,1,2,4,0`을 테스트한다고 가정해봅시다. 이는 증폭기 A에 페이즈 설정 `3`을, B에 `1`를, C에 `2`를, D에 `4`를, E에 `0`을 설정한다는 뜻입니다. 그러고나면, 당신은 최종 출력을 다음과 같이 계산할 수 있습니다.  

- 프로그램의 복사본을 증폭기 A에서 실행한다. 프로그램의 첫 번째 입력 명령어에서 페이즈 설정인 `3`을, 두 번째 입력 명령어에서 입력 신호인 `0`을 넣어준다. 계산이 끝나고나면 프로그램은 출력 명령어를 사용해 결과 값을 출력할 것입니다.
- 프로그램의 또 다른 복사본을 증폭기 B에서 실행하세요. 페이즈 설정에는 `1`을, 입력 신호로는 A의 결과 값을 넣어주세요.
- 마찬가지로 증폭기 C에서는 페이즈 설정으로 `2`를, 입력 신호로는 B의 결과 값을 넣어주세요.
- 증폭기 D에서는 페이즈 설정으로 `4`를, 입력 신호로 C의 결과 값을 넣어주세요.
- 마지막으로 증폭기 E에서는 페이즈 설정으로 `0`을, 입력 신호로 D의 결과 값을 넣어주세요.

증폭기 E의 결과 값이 추진 엔진에 보낼 최종 출력이 됩니다. 하지만 이 페이즈 설정(`3,1,2,4,0`)이 최선의 결과가 아닐 수 있습니다. 다른 페이즈 설정이라면 더 높은 출력을 만들지도 모릅니다.  

아래에는 몇가지 예시가 있습니다.
- 최대 출력 값 `43210` (페이즈 설정 `4,3,2,1,0`)
`3,15,3,16,1002,16,10,16,1,16,15,15,4,15,99,0,0`

- 최대 출력 값 `54321` (페이즈 설정 `0,1,2,3,4`)
`3,23,3,24,1002,24,10,24,1002,23,-1,23,101,5,23,23,1,24,23,23,4,23,99,0,0`

- 최대 출력 값 `65210` (페이즈 설정 `1,0,4,3,2`)
`3,31,3,32,1002,32,10,32,1001,31,-2,31,1007,31,0,33,1002,33,7,33,1,33,31,31,1,32,31,31,4,31,99,0,0,0`

증폭기들에 대해 모든 페이즈 설정 조합을 실행해보고, 추진 엔진에 보낼 수 있는 가장 큰 출력 값을 알려주세요.  

## Part 2
이 설정으로는, 증폭기가 필요한 만큼 충분한 출력을 만들어낼 수 없었습니다. 요정들은 재빨리 증폭기에 **피드백 루프(Feedback Loop)**를 적용하였습니다.   

``` text
      O-------O  O-------O  O-------O  O-------O  O-------O
0 -+->| Amp A |->| Amp B |->| Amp C |->| Amp D |->| Amp E |-.
   |  O-------O  O-------O  O-------O  O-------O  O-------O |
   |                                                        |
   '--------------------------------------------------------+
                                                            |
                                                            v
                                                     (to thrusters)
```

구조는 대체로 전과 비슷합니다. 증폭기 A의 출력이 증폭기 B의 입력이 되는 식이지요. 하지만, 증폭기 E의 출력이 추진 엔진으로 바로 이어지지 않고, 증폭기 A의 입력으로 다시 연결됩니다. 이는 피드백 루프를 만들고, 신호는 증폭기들을 여러 번 통과하게 될 것입니다.  

피드백 루프 모드에서는, 각 증폭기들이 이전과 전혀 다른 페이즈 설정을 가집니다. 각 증폭기는 `5`부터 `9`까지의 정수 중 하나를 페이즈 설정으로 사용합니다. 마찬가지로 각 숫자는 단 한번씩만 사용됩니다. 이 설정은 증폭기 제어 프로그램이 여러 개의 입력을 받아 여러 개의 출력을 만들어낼 수 있도록 해줍니다. 프로그램의 첫 번째 입력만 페이즈 설정 값이고, 나머지 모든 입력은 이전 증폭기의 출력을 사용합니다.  

피드백 루프가 도는 동안 각 증폭기의 프로그램은 재시작되어서는 안됩니다. 하나의 프로그램이 종료하기 전까지 여러 개의 신호를 받고 내보내며 계속 실행되어야 합니다.  

주고받는 모든 신호는 맨 처음 신호와 맨 마지막을 제외하고는, 다른 증폭기와 쌍을 이룰 것입니다. 프로그램을 실행하려면, 증폭기 A의 입력 신호에 `0`을 넣어주면 됩니다.  

최종적으로, 프로그램은 마지막 바퀴를 돈 뒤에 저절로 종료될 것입니다. 프로그램이 종료되면, 증폭기 E가 마지막으로 출력했던 신호 값이 추진 엔진으로 전달될 것입니다. 당신은 새로운 페이즈 설정, 피드백 루프를 사용하여 가장 큰 출력 신호를 찾아내야 합니다.  

여기 몇가지 예시가 있습니다.

- 최대 출력 값 `139629729` (페이즈 설정 `9,8,7,6,5`)
`3,26,1001,26,-4,26,3,27,1002,27,2,27,1,27,26,27,4,27,1001,28,-1,28,1005,28,6,99,0,0,5`

- 최대 출력 값 `18216` (페이즈 설정 `9,7,8,5,6`)
`3,52,1001,52,-5,52,3,53,1,52,56,54,1007,54,5,55,1005,55,26,1001,54,-5,54,1105,1,12,1,53,54,53,1008,54,0,55,1001,55,1,55,2,53,55,53,4,53,1001,56,-1,56,1005,56,6,99,0,0,0,0,10`

증폭기들에 대해 모든 페이즈 설정 조합을 실행해보고, 추진 엔진에 보낼 수 있는 가장 큰 출력 값을 알려주세요.  